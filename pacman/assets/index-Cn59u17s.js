var j=Object.defineProperty;var J=(h,e,t)=>e in h?j(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var a=(h,e,t)=>J(h,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const U=24,X=1,i=U*X,N=28,P=31,Q=N*i,tt=P*i,et=60,D=1e3/et,Y=13,H=21,w=1.4,k=13,V=11,q=13,B=13,K=11,b=13,$=15,Z=13,it=8,st=0,nt=31,rt=15e3,ot=1e4,ht=100,at=5,ct=200,lt=1e4,ut=13,Tt=14,p={PACMAN:"#FFFF00",BLINKY:"#FF0000",PINKY:"#FFB8FF",INKY:"#00FFFF",CLYDE:"#FFB852",WALL:"#2121DE",PELLET:"#FFB8AE",POWER_PELLET:"#FFB8AE",GATE:"#FFB8FF",BACKGROUND:"#000000"},m={SCORE_LABEL:"SCORE: ",LIVES_LABEL:"LIVES: ",GAME_OVER_TEXT:"GAME OVER",WIN_TEXT:"YOU WIN!",START_TEXT:"CLICK TO START"};var n=(h=>(h[h.NONE=0]="NONE",h[h.UP=1]="UP",h[h.DOWN=2]="DOWN",h[h.LEFT=3]="LEFT",h[h.RIGHT=4]="RIGHT",h))(n||{}),E=(h=>(h[h.START_SCREEN=0]="START_SCREEN",h[h.PLAYING=1]="PLAYING",h[h.DYING=2]="DYING",h[h.GAME_OVER=3]="GAME_OVER",h[h.WIN=4]="WIN",h))(E||{});class Et{constructor(){a(this,"queuedKey",n.NONE);window.addEventListener("keydown",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.queuedKey=n.UP;break;case"ArrowDown":case"KeyS":this.queuedKey=n.DOWN;break;case"ArrowLeft":case"KeyA":this.queuedKey=n.LEFT;break;case"ArrowRight":case"KeyD":this.queuedKey=n.RIGHT;break}})}getDirection(){return this.queuedKey}reset(){this.queuedKey=n.NONE}}const A={EMPTY:0,WALL:1,PELLET:2,POWER_PELLET:3,GATE:4},F=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1],[1,3,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,3,1],[1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,2,1],[1,2,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,2,1],[1,2,2,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,2,2,1],[1,1,1,1,1,1,2,1,1,1,1,1,0,1,1,0,1,1,1,1,1,2,1,1,1,1,1,1],[0,0,0,0,0,1,2,1,1,1,1,1,0,1,1,0,1,1,1,1,1,2,1,0,0,0,0,0],[0,0,0,0,0,1,2,1,1,0,0,0,0,0,0,0,0,0,0,1,1,2,1,0,0,0,0,0],[1,1,1,1,1,1,2,1,1,0,1,1,1,4,4,1,1,1,0,1,1,2,1,1,1,1,1,1],[0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0],[1,1,1,1,1,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,1,1,1,1,1],[0,0,0,0,0,1,2,1,1,0,0,0,0,0,0,0,0,0,0,1,1,2,1,0,0,0,0,0],[0,0,0,0,0,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,0,0,0,0,0],[1,1,1,1,1,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1],[1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1],[1,3,2,2,1,1,2,2,2,2,2,2,2,0,0,2,2,2,2,2,2,2,1,1,2,2,3,1],[1,1,1,2,1,1,2,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,1,1],[1,1,1,2,1,1,2,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,1,1],[1,2,2,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,2,2,1],[1,2,1,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1],[1,2,1,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];for(;F.length<P;)F.push(new Array(N).fill(0));class v{constructor(){a(this,"map");a(this,"pelletCount",0);this.map=F.map(e=>[...e]),this.countPellets()}countPellets(){this.pelletCount=0;for(let e=0;e<P;e++)for(let t=0;t<N;t++)(this.map[e][t]===A.PELLET||this.map[e][t]===A.POWER_PELLET)&&this.pelletCount++}draw(e){for(let t=0;t<P;t++)for(let s=0;s<N;s++){const o=this.map[t][s],r=s*i,c=t*i;o===A.WALL?(e.fillStyle=p.WALL,e.fillRect(r,c,i,i),e.fillStyle=p.BACKGROUND,e.fillRect(r+4,c+4,i-8,i-8),e.strokeStyle=p.WALL,e.lineWidth=2,e.strokeRect(r+6,c+6,i-12,i-12)):o===A.PELLET?(e.fillStyle=p.PELLET,e.beginPath(),e.arc(r+i/2,c+i/2,2,0,Math.PI*2),e.fill()):o===A.POWER_PELLET?(e.fillStyle=p.POWER_PELLET,e.beginPath(),e.arc(r+i/2,c+i/2,6,0,Math.PI*2),e.fill()):o===A.GATE&&(e.fillStyle=p.GATE,e.fillRect(r,c+i/2-2,i,4))}}getTile(e,t){return t<0||t>=P||e<0||e>=N?A.EMPTY:this.map[t][e]}isWall(e,t,s=!1){const o=this.getTile(e,t);return s&&o===A.GATE?!1:o===A.WALL||o===A.GATE}getPelletCount(){return this.pelletCount}removePellet(e,t){const s=this.getTile(e,t);return s===2?(this.map[t][e]=0,this.pelletCount--,2):s===3?(this.map[t][e]=0,this.pelletCount--,3):0}getCols(){return N}}class z{constructor(e,t,s){a(this,"x");a(this,"y");a(this,"direction",n.NONE);a(this,"nextDirection",n.NONE);a(this,"speed",0);a(this,"radius");this.x=e,this.y=t,this.speed=s,this.radius=U*X/2}canMove(e,t){const s=Math.floor((this.x+this.radius)/i),o=Math.floor((this.y+this.radius)/i);let r=s,c=o;e===n.LEFT&&(r-=1),e===n.RIGHT&&(r+=1),e===n.UP&&(c-=1),e===n.DOWN&&(c+=1);const T=s*i+i/2,l=o*i+i/2;if(Math.sqrt(Math.pow(this.x+this.radius-T,2)+Math.pow(this.y+this.radius-l,2))>5){if(this.direction===n.LEFT||this.direction===n.RIGHT)return e===n.LEFT||e===n.RIGHT;if(this.direction===n.UP||this.direction===n.DOWN)return e===n.UP||e===n.DOWN}return!t.isWall(r,c)}snapToGrid(){const e=Math.floor((this.x+this.radius)/i),t=Math.floor((this.y+this.radius)/i);this.x=e*i,this.y=t*i}}class ft extends z{constructor(t,s){super(t*i,s*i,1.75);a(this,"mouthOpen",0);a(this,"mouthSpeed",.02);a(this,"mouthOpening",!0);a(this,"rotation",0);a(this,"deathProgress",0);this.direction=n.RIGHT,this.nextDirection=n.RIGHT}update(t,s){const o=t/D;if(this.mouthOpening?(this.mouthOpen+=this.mouthSpeed*o,this.mouthOpen>=.25&&(this.mouthOpening=!1)):(this.mouthOpen-=this.mouthSpeed*o,this.mouthOpen<=0&&(this.mouthOpening=!0)),this.nextDirection!==n.NONE&&this.nextDirection!==this.direction){const x=this.x+i/2,S=this.y+i/2,O=Math.floor(x/i),L=Math.floor(S/i),R=O*i+i/2,d=L*i+i/2;if(Math.sqrt(Math.pow(x-R,2)+Math.pow(S-d,2))<4){let I=!1;this.nextDirection===n.LEFT&&!s.isWall(O-1,L)&&(I=!0),this.nextDirection===n.RIGHT&&!s.isWall(O+1,L)&&(I=!0),this.nextDirection===n.UP&&!s.isWall(O,L-1)&&(I=!0),this.nextDirection===n.DOWN&&!s.isWall(O,L+1)&&(I=!0),I&&(this.direction=this.nextDirection,this.direction===n.UP||this.direction===n.DOWN?this.x=O*i:this.y=L*i)}}const r=this.speed*o,c=this.x+i/2,T=this.y+i/2,l=Math.floor(c/i),u=Math.floor(T/i);this.direction===n.LEFT?!s.isWall(l-1,u)||c-(l*i+i/2)>0?(this.x-=r,this.rotation=Math.PI):this.x=l*i:this.direction===n.RIGHT?!s.isWall(l+1,u)||l*i+i/2-c>0?(this.x+=r,this.rotation=0):this.x=l*i:this.direction===n.UP?!s.isWall(l,u-1)||T-(u*i+i/2)>0?(this.y-=r,this.rotation=-Math.PI/2):this.y=u*i:this.direction===n.DOWN&&(!s.isWall(l,u+1)||u*i+i/2-T>0?(this.y+=r,this.rotation=Math.PI/2):this.y=u*i);const y=s.removePellet(l,u);return this.x<-i&&(this.x=s.getCols()*i),this.x>s.getCols()*i&&(this.x=-i),y}updateDeath(t){const s=t/D;return this.deathProgress+=.015*s,this.deathProgress>=1?(this.deathProgress=1,!0):!1}draw(t){const s=this.x+i/2,o=this.y+i/2;if(t.save(),t.translate(s,o),t.rotate(this.rotation),t.fillStyle=p.PACMAN,t.beginPath(),this.deathProgress>0){const r=this.deathProgress*Math.PI;t.arc(0,0,i/2-2,r,Math.PI*2-r)}else t.arc(0,0,i/2-2,this.mouthOpen*Math.PI,(2-this.mouthOpen)*Math.PI);t.lineTo(0,0),t.fill(),t.restore()}setNextDirection(t){this.nextDirection=t}}var f=(h=>(h[h.SCATTER=0]="SCATTER",h[h.CHASE=1]="CHASE",h[h.FRIGHTENED=2]="FRIGHTENED",h[h.EATEN=3]="EATEN",h[h.EXITING_HOUSE=4]="EXITING_HOUSE",h))(f||{});class C extends z{constructor(t,s,o,r){super(t*i,s*i,r);a(this,"state",0);a(this,"color");a(this,"targetX",0);a(this,"targetY",0);a(this,"frightenedColor","#0000FF");a(this,"eatenColor","transparent");this.color=o,this.direction=n.LEFT}update(t,s,o,r){if(!o)return;let c=this.getTarget(o,r);this.state===4&&(c={x:13*i,y:11*i},Math.sqrt(Math.pow(this.x-c.x,2)+Math.pow(this.y-c.y,2))<2&&(this.state=0,this.direction=n.LEFT)),this.targetX=c.x,this.targetY=c.y;const T=this.x+i/2,l=this.y+i/2,u=Math.floor(T/i),y=Math.floor(l/i),x=u*i+i/2,S=y*i+i/2;if(Math.sqrt(Math.pow(T-x,2)+Math.pow(l-S,2))<2){const d=[];if(this.direction!==n.DOWN&&!s.isWall(u,y-1,!0)&&d.push(n.UP),this.direction!==n.UP&&!s.isWall(u,y+1,!0)&&d.push(n.DOWN),this.direction!==n.RIGHT&&!s.isWall(u-1,y,!0)&&d.push(n.LEFT),this.direction!==n.LEFT&&!s.isWall(u+1,y,!0)&&d.push(n.RIGHT),d.length>0){let _=d[0];if(this.state===2)_=d[Math.floor(Math.random()*d.length)];else{let I=1/0;for(const g of d){let M=u,G=y;g===n.UP&&G--,g===n.DOWN&&G++,g===n.LEFT&&M--,g===n.RIGHT&&M++;const W=Math.sqrt(Math.pow(M*i-this.targetX,2)+Math.pow(G*i-this.targetY,2));W<I&&(I=W,_=g)}}this.direction=_,this.direction===n.UP||this.direction===n.DOWN?this.x=u*i:this.y=y*i}else this.direction===n.UP?this.direction=n.DOWN:this.direction===n.DOWN?this.direction=n.UP:this.direction===n.LEFT?this.direction=n.RIGHT:this.direction===n.RIGHT&&(this.direction=n.LEFT)}const L=t/D,R=this.speed*L;this.direction===n.UP?this.y-=R:this.direction===n.DOWN?this.y+=R:this.direction===n.LEFT?this.x-=R:this.direction===n.RIGHT&&(this.x+=R),this.x<-i&&(this.x=s.getCols()*i),this.x>s.getCols()*i&&(this.x=-i)}draw(t){const s=this.x+i/2,o=this.y+i/2;t.fillStyle=this.state===2?this.frightenedColor:this.color,t.beginPath(),t.arc(s,o-2,i/2-2,Math.PI,0),t.lineTo(s+i/2-2,o+i/2-2),t.lineTo(s-i/2+2,o+i/2-2),t.fill(),t.fillStyle="white",t.beginPath(),t.arc(s-4,o-4,4,0,Math.PI*2),t.arc(s+4,o-4,4,0,Math.PI*2),t.fill(),t.fillStyle="blue",t.beginPath();let r=0,c=0;this.direction===n.UP&&(c=-2),this.direction===n.DOWN&&(c=2),this.direction===n.LEFT&&(r=-2),this.direction===n.RIGHT&&(r=2),t.arc(s-4+r,o-4+c,2,0,Math.PI*2),t.arc(s+4+r,o-4+c,2,0,Math.PI*2),t.fill()}}class dt extends C{constructor(){super(k,V,p.BLINKY,w)}getTarget(e){return{x:e.x,y:e.y}}}class mt extends C{constructor(){super(q,B,p.PINKY,w)}getTarget(e){let t=e.x,s=e.y;return e.direction===n.UP&&(s-=4*i),e.direction===n.DOWN&&(s+=4*i),e.direction===n.LEFT&&(t-=4*i),e.direction===n.RIGHT&&(t+=4*i),{x:t,y:s}}}class pt extends C{constructor(){super(K,b,p.INKY,w)}getTarget(e,t){return t?{x:e.x,y:e.y}:{x:e.x,y:e.y}}}class At extends C{constructor(){super($,Z,p.CLYDE,w)}getTarget(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))>it*i?{x:e.x,y:e.y}:{x:st*i,y:nt*i}}}class yt{constructor(){a(this,"ctx");a(this,"wakaOscillator",null);a(this,"wakaGain",null);a(this,"isWakaPlaying",!1);this.ctx=new(window.AudioContext||window.webkitAudioContext)}playWaka(){this.isWakaPlaying||(this.isWakaPlaying=!0,this.wakaOscillator=this.ctx.createOscillator(),this.wakaOscillator.type="triangle",this.wakaOscillator.frequency.setValueAtTime(300,this.ctx.currentTime),this.wakaOscillator.frequency.linearRampToValueAtTime(100,this.ctx.currentTime+.2),this.wakaGain=this.ctx.createGain(),this.wakaGain.gain.setValueAtTime(.1,this.ctx.currentTime),this.wakaGain.gain.linearRampToValueAtTime(0,this.ctx.currentTime+.2),this.wakaOscillator.connect(this.wakaGain),this.wakaGain.connect(this.ctx.destination),this.wakaOscillator.start(),this.wakaOscillator.stop(this.ctx.currentTime+.2),this.wakaOscillator.onended=()=>{this.isWakaPlaying=!1})}playEatGhost(){const e=this.ctx.createOscillator(),t=this.ctx.createGain();e.type="sawtooth",e.frequency.setValueAtTime(800,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(1200,this.ctx.currentTime+.1),t.gain.setValueAtTime(.1,this.ctx.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),e.connect(t),t.connect(this.ctx.destination),e.start(),e.stop(this.ctx.currentTime+.1)}playDeath(){const e=this.ctx.currentTime,t=12;for(let s=0;s<t;s++){const o=this.ctx.createOscillator(),r=this.ctx.createGain();o.type="sawtooth";const c=1e3-s*80,T=c-100,l=e+s*.12;o.frequency.setValueAtTime(c,l),o.frequency.linearRampToValueAtTime(T,l+.1),r.gain.setValueAtTime(.2,l),r.gain.linearRampToValueAtTime(0,l+.1),o.connect(r),r.connect(this.ctx.destination),o.start(l),o.stop(l+.1)}setTimeout(()=>{const s=this.ctx.createOscillator(),o=this.ctx.createGain();s.type="square",s.frequency.setValueAtTime(300,this.ctx.currentTime),s.frequency.exponentialRampToValueAtTime(50,this.ctx.currentTime+.2),o.gain.setValueAtTime(.2,this.ctx.currentTime),o.gain.linearRampToValueAtTime(0,this.ctx.currentTime+.2),s.connect(o),o.connect(this.ctx.destination),s.start(),s.stop(this.ctx.currentTime+.2)},1500)}resume(){this.ctx.state==="suspended"&&this.ctx.resume()}playGameStart(){const e=this.ctx.currentTime+.05,t=.11,s=(o,r,c)=>{const T=this.ctx.createOscillator(),l=this.ctx.createGain();T.type="square",T.frequency.setValueAtTime(o,r),l.gain.setValueAtTime(.1,r),l.gain.setValueAtTime(0,r+c-.01),T.connect(l),l.connect(this.ctx.destination),T.start(r),T.stop(r+c)};s(493.88,e+0*t,t),s(987.77,e+1*t,t),s(739.99,e+2*t,t),s(622.25,e+3*t,t),s(987.77,e+4*t,t),s(739.99,e+5*t,t/2),s(622.25,e+5.5*t,t*2.5),s(523.25,e+8*t,t),s(1046.5,e+9*t,t),s(783.99,e+10*t,t),s(659.25,e+11*t,t),s(1046.5,e+12*t,t),s(783.99,e+13*t,t/2),s(659.25,e+13.5*t,t*2.5),s(493.88,e+16*t,t),s(987.77,e+17*t,t),s(739.99,e+18*t,t),s(622.25,e+19*t,t),s(987.77,e+20*t,t),s(739.99,e+21*t,t/2),s(622.25,e+21.5*t,t*2.5),s(622.25,e+24*t,t),s(659.25,e+25*t,t),s(698.46,e+26*t,t),s(739.99,e+27*t,t),s(783.99,e+28*t,t),s(830.61,e+29*t,t),s(880,e+30*t,t),s(987.77,e+31*t,t*4)}}class Lt{constructor(){a(this,"canvas");a(this,"ctx");a(this,"lastTime",0);a(this,"input");a(this,"level");a(this,"pacman");a(this,"ghosts",[]);a(this,"audio");a(this,"score",0);a(this,"lives",3);a(this,"scoreElement");a(this,"livesElement");a(this,"gameOverElement");a(this,"winElement");a(this,"startScreenElement");a(this,"frightenedTimer",0);a(this,"gameState",E.START_SCREEN);a(this,"fruitActive",!1);a(this,"fruitTimer",0);a(this,"fruitX",12*i);a(this,"fruitY",20*i);a(this,"fruitScore",100);this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.scoreElement=document.getElementById("score"),this.livesElement=document.getElementById("lives"),this.gameOverElement=document.getElementById("game-over"),this.winElement=document.getElementById("win-screen"),this.startScreenElement=document.getElementById("start-screen"),this.scoreElement.innerText=`${m.SCORE_LABEL}${this.score}`,this.livesElement.innerText=`${m.LIVES_LABEL}${this.lives}`,this.gameOverElement.innerText=m.GAME_OVER_TEXT,this.winElement.innerText=m.WIN_TEXT,this.startScreenElement.innerText=m.START_TEXT,this.input=new Et,this.level=new v,this.audio=new yt,this.pacman=new ft(Y,H);const e=new dt,t=new mt,s=new pt,o=new At;t.state=f.EXITING_HOUSE,s.state=f.EXITING_HOUSE,o.state=f.EXITING_HOUSE,this.ghosts.push(e),this.ghosts.push(t),this.ghosts.push(s),this.ghosts.push(o),window.addEventListener("keydown",()=>{this.gameState===E.START_SCREEN&&this.resetGame()}),this.init()}enterState(e){switch(this.gameState=e,this.gameOverElement.classList.add("hidden"),this.winElement.classList.add("hidden"),this.startScreenElement.classList.add("hidden"),e){case E.START_SCREEN:this.startScreenElement.classList.remove("hidden");break;case E.PLAYING:this.audio.resume();break;case E.DYING:this.audio.playDeath();break;case E.GAME_OVER:this.gameOverElement.classList.remove("hidden");break;case E.WIN:this.winElement.classList.remove("hidden");break}}init(){this.canvas.width=Q,this.canvas.height=tt,requestAnimationFrame(e=>this.gameLoop(e))}resetGame(){this.audio.playGameStart(),this.enterState(E.PLAYING),this.score=0,this.lives=3,this.level=new v,this.frightenedTimer=0,this.fruitActive=!1,this.fruitTimer=0,this.scoreElement.innerText=`${m.SCORE_LABEL}${this.score}`,this.livesElement.innerText=`${m.LIVES_LABEL}${this.lives}`,this.resetPositions()}resetPositions(){this.pacman.x=Y*i,this.pacman.y=H*i,this.pacman.direction=n.RIGHT,this.pacman.nextDirection=n.RIGHT,this.pacman.deathProgress=0,this.ghosts.forEach((e,t)=>{t===0?(e.x=k*i,e.y=V*i):t===1?(e.x=q*i,e.y=B*i,e.state=f.EXITING_HOUSE):t===2?(e.x=K*i,e.y=b*i,e.state=f.EXITING_HOUSE):(e.x=$*i,e.y=Z*i,e.state=f.EXITING_HOUSE),t===0&&(e.state=f.SCATTER)})}gameLoop(e){const t=e-this.lastTime;this.lastTime=e,this.update(t),this.draw(),requestAnimationFrame(s=>this.gameLoop(s))}update(e){if(this.gameState===E.DYING){this.pacman.updateDeath(e)&&(this.lives--,this.livesElement.innerText=`${m.LIVES_LABEL}${this.lives}`,this.lives<=0?this.enterState(E.GAME_OVER):(this.enterState(E.PLAYING),this.resetPositions()));return}if(this.gameState!==E.PLAYING)return;const t=this.input.getDirection();t!==n.NONE&&this.pacman.setNextDirection(t);const s=this.pacman.update(e,this.level);s===2?(this.score+=10,this.scoreElement.innerText=`${m.SCORE_LABEL}${this.score}`,this.audio.playWaka()):s===3&&(this.score+=50,this.scoreElement.innerText=`${m.SCORE_LABEL}${this.score}`,this.frightenedTimer=lt,this.ghosts.forEach(r=>r.state=f.FRIGHTENED)),this.level.getPelletCount()===0&&this.enterState(E.WIN),this.fruitActive?(this.fruitTimer+=e,this.fruitTimer>ot&&(this.fruitActive=!1,this.fruitTimer=0),Math.sqrt(Math.pow(this.pacman.x-this.fruitX,2)+Math.pow(this.pacman.y-this.fruitY,2))<i&&(this.score+=this.fruitScore,this.scoreElement.innerText=`${m.SCORE_LABEL}${this.score}`,this.fruitActive=!1,this.fruitTimer=0,this.audio.playEatGhost())):(this.fruitTimer+=e,this.fruitTimer>rt&&(this.fruitActive=!0,this.fruitTimer=0,this.fruitScore=Math.floor(Math.random()*at+1)*ht)),this.frightenedTimer>0&&(this.frightenedTimer-=e,this.frightenedTimer<=0&&this.ghosts.forEach(r=>{r.state===f.FRIGHTENED&&(r.state=f.SCATTER)}));const o=this.ghosts[0];this.ghosts.forEach((r,c)=>{r.update(e,this.level,this.pacman,o),Math.sqrt(Math.pow(this.pacman.x-r.x,2)+Math.pow(this.pacman.y-r.y,2))<i&&(r.state===f.FRIGHTENED?(r.state=f.EATEN,this.score+=ct,this.scoreElement.innerText=`${m.SCORE_LABEL}${this.score}`,this.audio.playEatGhost(),r.x=ut*i,r.y=Tt*i,r.state=f.SCATTER):r.state!==f.EATEN&&(console.log("Collision with ghost!"),this.enterState(E.DYING)))})}draw(){this.ctx.fillStyle=p.BACKGROUND,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.level.draw(this.ctx),this.fruitActive&&(this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(this.fruitX+i/2,this.fruitY+i/2,5,0,Math.PI*2),this.ctx.fill()),this.pacman.draw(this.ctx),this.ghosts.forEach(e=>e.draw(this.ctx))}}console.log("Pac-Man Clone Initialized");window.addEventListener("DOMContentLoaded",()=>{new Lt});
