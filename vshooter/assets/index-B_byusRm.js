var y=Object.defineProperty;var m=(l,e,t)=>e in l?y(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var s=(l,e,t)=>m(l,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))i(h);new MutationObserver(h=>{for(const n of h)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(h){const n={};return h.integrity&&(n.integrity=h.integrity),h.referrerPolicy&&(n.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?n.credentials="include":h.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(h){if(h.ep)return;h.ep=!0;const n=t(h);fetch(h.href,n)}})();class E{constructor(){s(this,"currentState",null)}changeState(e){this.currentState&&this.currentState.exit(),this.currentState=e,this.currentState.enter()}update(e){this.currentState&&this.currentState.update(e)}render(e){this.currentState&&this.currentState.render(e)}}class S{constructor(){s(this,"keys",new Set);s(this,"previousKeys",new Set);window.addEventListener("keydown",e=>{this.keys.add(e.code)}),window.addEventListener("keyup",e=>{this.keys.delete(e.code)})}update(){this.previousKeys=new Set(this.keys)}isDown(e){return this.keys.has(e)}isPressed(e){return this.keys.has(e)&&!this.previousKeys.has(e)}}const a={SCREEN_WIDTH:600,SCREEN_HEIGHT:800,PLAYER_SPEED:300,PLAYER_WIDTH:32,PLAYER_HEIGHT:32,BULLET_SPEED:500,BULLET_WIDTH:4,BULLET_HEIGHT:10,ENEMY_WIDTH:32,ENEMY_HEIGHT:32,PLAYER_LIVES:3,PLAYER_BOMBS:3,COLOR_ENEMY_1:"red",COLOR_ENEMY_2:"orange",COLOR_BULLET_PLAYER:"yellow",COLOR_BULLET_ENEMY:"pink"};class c{constructor(e,t,i,h,n){s(this,"x");s(this,"y");s(this,"width",a.BULLET_WIDTH);s(this,"height",a.BULLET_HEIGHT);s(this,"active",!0);s(this,"isPlayerBullet");s(this,"velocityX");s(this,"velocityY");this.x=e,this.y=t,this.velocityX=i,this.velocityY=h,this.isPlayerBullet=n}update(e){this.x+=this.velocityX*e,this.y+=this.velocityY*e,(this.y<-this.height||this.y>a.SCREEN_HEIGHT||this.x<-this.width||this.x>a.SCREEN_WIDTH)&&(this.active=!1)}render(e){e.fillStyle=this.isPlayerBullet?a.COLOR_BULLET_PLAYER:a.COLOR_BULLET_ENEMY,e.fillRect(this.x,this.y,this.width,this.height)}}class T{constructor(e,t,i,h=0){s(this,"game");s(this,"x");s(this,"y");s(this,"width",a.PLAYER_WIDTH);s(this,"height",a.PLAYER_HEIGHT);s(this,"lives",a.PLAYER_LIVES);s(this,"bombs",a.PLAYER_BOMBS);s(this,"score",0);s(this,"speed",a.PLAYER_SPEED);s(this,"lastShotTime",0);s(this,"shootCooldown",.2);s(this,"shipType",0);this.game=e,this.x=t,this.y=i,this.shipType=h}update(e,t){const i=this.game.getInputManager(),h=this.game.getCanvas();if(i.isDown("ArrowLeft")&&(this.x-=this.speed*e),i.isDown("ArrowRight")&&(this.x+=this.speed*e),i.isDown("ArrowUp")&&(this.y-=this.speed*e),i.isDown("ArrowDown")&&(this.y+=this.speed*e),this.x<0&&(this.x=0),this.x>h.width-this.width&&(this.x=h.width-this.width),this.y<0&&(this.y=0),this.y>h.height-this.height&&(this.y=h.height-this.height),i.isDown("Space")){const n=performance.now()/1e3;n-this.lastShotTime>=this.shootCooldown&&(this.shoot(t),this.lastShotTime=n)}}render(e){const t=["cyan","lime","magenta"];e.fillStyle=t[this.shipType%t.length],e.beginPath(),this.shipType===0?(e.moveTo(this.x+this.width/2,this.y),e.lineTo(this.x+this.width,this.y+this.height),e.lineTo(this.x,this.y+this.height)):this.shipType===1?(e.moveTo(this.x+this.width/2,this.y),e.lineTo(this.x+this.width*.8,this.y+this.height),e.lineTo(this.x+this.width*.2,this.y+this.height)):(e.moveTo(this.x+this.width/2,this.y+this.height*.2),e.lineTo(this.x+this.width,this.y+this.height),e.lineTo(this.x,this.y+this.height)),e.closePath(),e.fill()}shoot(e){const t=this.x,i=this.x+this.width-a.BULLET_WIDTH,h=this.y;e.push(new c(t,h,0,-500,!0)),e.push(new c(i,h,0,-500,!0))}tryUseBomb(){return this.bombs>0?(this.bombs--,!0):!1}getShipType(){return this.shipType}}class o{constructor(e,t){s(this,"x");s(this,"y");s(this,"active",!0);s(this,"duration",.5);s(this,"timer",0);s(this,"maxRadius",40);this.x=e,this.y=t}update(e){this.timer+=e,this.timer>=this.duration&&(this.active=!1)}render(e){const t=this.timer/this.duration,i=this.maxRadius*Math.sin(t*Math.PI),h=1-t;e.save(),e.globalAlpha=h,e.fillStyle="orange",e.beginPath(),e.arc(this.x,this.y,i,0,Math.PI*2),e.fill(),e.restore()}}class w{constructor(){s(this,"active",!0);s(this,"duration",1);s(this,"timer",0);s(this,"explosions",[]);s(this,"spawnTimer",0);s(this,"spawnInterval",.05)}update(e){if(this.timer+=e,this.spawnTimer+=e,this.timer<this.duration&&this.spawnTimer>=this.spawnInterval){this.spawnTimer=0;const t=Math.random()*a.SCREEN_WIDTH,i=Math.random()*a.SCREEN_HEIGHT;this.explosions.push(new o(t,i))}this.explosions.forEach(t=>t.update(e)),this.explosions=this.explosions.filter(t=>t.active),this.timer>=this.duration&&this.explosions.length===0&&(this.active=!1)}render(e){this.timer<.2&&(e.save(),e.fillStyle="white",e.globalAlpha=1-this.timer/.2,e.fillRect(0,0,a.SCREEN_WIDTH,a.SCREEN_HEIGHT),e.restore()),this.explosions.forEach(t=>t.render(e))}}class v{constructor(){s(this,"map");s(this,"tileSize",40);s(this,"scrollY",0);s(this,"scrollSpeed",50);s(this,"rows");s(this,"cols");s(this,"colors",["#000033","#000044","#000055","#000066"]);this.cols=Math.ceil(a.SCREEN_WIDTH/this.tileSize),this.rows=Math.ceil(a.SCREEN_HEIGHT/this.tileSize)+2,this.map=this.generateMap()}generateMap(){const e=[];for(let t=0;t<this.rows;t++){const i=[];for(let h=0;h<this.cols;h++)i.push(Math.floor(Math.random()*this.colors.length));e.push(i)}return e}update(e){if(this.scrollY+=this.scrollSpeed*e,this.scrollY>=this.tileSize){this.scrollY-=this.tileSize,this.map.pop();const t=[];for(let i=0;i<this.cols;i++)t.push(Math.floor(Math.random()*this.colors.length));this.map.unshift(t)}}render(e){for(let t=0;t<this.rows;t++)for(let i=0;i<this.cols;i++){const h=this.map[t][i];e.fillStyle=this.colors[h];const n=i*this.tileSize,r=(t-1)*this.tileSize+this.scrollY;e.fillRect(n,r,this.tileSize,this.tileSize)}}}var g=(l=>(l[l.FAST=0]="FAST",l[l.SLOW=1]="SLOW",l))(g||{});class L{constructor(e,t,i){s(this,"x");s(this,"y");s(this,"width",a.ENEMY_WIDTH);s(this,"height",a.ENEMY_HEIGHT);s(this,"active",!0);s(this,"type");s(this,"speed");s(this,"shootTimer",0);s(this,"shootInterval");this.x=e,this.y=t,this.type=i,i===0?(this.speed=150,this.shootInterval=1.5):(this.speed=50,this.shootInterval=2.5)}update(e,t,i,h){this.y+=this.speed*e,this.type===0&&(this.x+=Math.sin(this.y*.05)*2),this.shootTimer+=e,this.shootTimer>=this.shootInterval&&(this.shootTimer=0,this.shoot(t,i,h)),this.y>a.SCREEN_HEIGHT&&(this.active=!1)}shoot(e,t,i){if(this.type===0){const h=t-this.x,n=i-this.y,r=Math.atan2(n,h),p=Math.cos(r)*a.BULLET_SPEED*.5,u=Math.sin(r)*a.BULLET_SPEED*.5;e.push(new c(this.x+this.width/2,this.y+this.height,p,u,!1))}else e.push(new c(this.x+this.width/2,this.y+this.height,0,a.BULLET_SPEED*.5,!1))}render(e){e.fillStyle=this.type===0?a.COLOR_ENEMY_1:a.COLOR_ENEMY_2,e.fillRect(this.x,this.y,this.width,this.height)}}class M{constructor(){s(this,"gameTime",0);s(this,"level",1);s(this,"spawnTimer",0);s(this,"spawnInterval",2)}update(e,t){this.gameTime+=e,this.spawnTimer+=e,this.spawnTimer>=this.spawnInterval&&(this.spawnTimer=0,this.spawnEnemy(t),this.spawnInterval>.5&&(this.spawnInterval-=.01))}spawnEnemy(e){const t=Math.random()*(a.SCREEN_WIDTH-a.ENEMY_WIDTH),i=-32,h=Math.random()>.5?g.FAST:g.SLOW;e.push(new L(t,i,h))}getLevel(){return this.level}}class P{constructor(e,t){s(this,"game");s(this,"score");this.game=e,this.score=t}enter(){console.log("Entering GameOver State")}exit(){console.log("Exiting GameOver State")}update(e){const t=this.game.getInputManager();(t.isPressed("Space")||t.isPressed("Enter"))&&this.game.getStateMachine().changeState(new f(this.game))}render(e){const t=e.canvas.width,i=e.canvas.height;e.fillStyle="black",e.fillRect(0,0,t,i),e.fillStyle="red",e.font="64px Arial",e.textAlign="center",e.fillText("GAME OVER",t/2,i/3),e.fillStyle="white",e.font="36px Arial",e.fillText(`Final Score: ${this.score}`,t/2,i/2),e.font="24px Arial",e.fillText("Press SPACE to Restart",t/2,i*.8)}}class R{constructor(e,t,i){s(this,"game");s(this,"score");s(this,"shipType");this.game=e,this.score=t,this.shipType=i}enter(){console.log("Entering StageClear State")}exit(){console.log("Exiting StageClear State")}update(e){const t=this.game.getInputManager();(t.isPressed("Space")||t.isPressed("Enter"))&&this.game.getStateMachine().changeState(new d(this.game,this.shipType))}render(e){const t=e.canvas.width,i=e.canvas.height;e.fillStyle="black",e.fillRect(0,0,t,i),e.fillStyle="white",e.font="48px Arial",e.textAlign="center",e.fillText("STAGE CLEAR!",t/2,i/3),e.font="36px Arial",e.fillText(`Score: ${this.score}`,t/2,i/2),e.font="24px Arial",e.fillText("Press SPACE for Next Stage",t/2,i*.8)}}class A{constructor(e,t=0){s(this,"game");s(this,"player");s(this,"bullets",[]);s(this,"enemies",[]);s(this,"explosions",[]);s(this,"clusterBomb",null);s(this,"tileMap");s(this,"levelManager");s(this,"gameTimer",0);s(this,"LEVEL_DURATION",300);this.game=e,this.player=new T(e,a.SCREEN_WIDTH/2-a.PLAYER_WIDTH/2,a.SCREEN_HEIGHT-100,t),this.tileMap=new v,this.levelManager=new M}enter(){console.log("Entering Playing State")}exit(){console.log("Exiting Playing State")}update(e){if(this.gameTimer+=e,this.gameTimer>=this.LEVEL_DURATION){this.game.getStateMachine().changeState(new R(this.game,this.player.score,this.player.getShipType()));return}this.tileMap.update(e),this.levelManager.update(e,this.enemies),this.player.update(e,this.bullets),this.bullets.forEach(i=>i.update(e)),this.bullets=this.bullets.filter(i=>i.active),this.enemies.forEach(i=>i.update(e,this.bullets,this.player.x,this.player.y)),this.enemies=this.enemies.filter(i=>i.active),this.explosions.forEach(i=>i.update(e)),this.explosions=this.explosions.filter(i=>i.active),this.clusterBomb&&(this.clusterBomb.update(e),this.clusterBomb.active||(this.clusterBomb=null)),this.checkCollisions(),this.player.lives<=0&&this.game.getStateMachine().changeState(new P(this.game,this.player.score)),this.game.getInputManager().isPressed("Enter")&&this.player.tryUseBomb()&&(this.clusterBomb=new w,this.enemies.forEach(i=>{this.explosions.push(new o(i.x+i.width/2,i.y+i.height/2)),this.player.score+=100}),this.enemies=[],console.log("Bomb used! All enemies destroyed."))}checkCollisions(){for(const e of this.bullets)if(!(!e.active||!e.isPlayerBullet)){for(const t of this.enemies)if(t.active&&this.checkRectCollision(e,t)){e.active=!1,t.active=!1,this.explosions.push(new o(t.x+t.width/2,t.y+t.height/2)),this.player.score+=100;break}}for(const e of this.bullets)!e.active||e.isPlayerBullet||this.checkRectCollision(e,this.player)&&(e.active=!1,this.handlePlayerHit());for(const e of this.enemies)e.active&&this.checkRectCollision(e,this.player)&&(e.active=!1,this.explosions.push(new o(e.x+e.width/2,e.y+e.height/2)),this.handlePlayerHit())}handlePlayerHit(){this.player.lives--,this.explosions.push(new o(this.player.x+this.player.width/2,this.player.y+this.player.height/2)),console.log("Player Hit! Lives:",this.player.lives)}checkRectCollision(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}render(e){const t=e.canvas.width,i=e.canvas.height;e.clearRect(0,0,t,i),this.tileMap.render(e),this.player.render(e),this.bullets.forEach(h=>h.render(e)),this.enemies.forEach(h=>h.render(e)),this.explosions.forEach(h=>h.render(e)),this.clusterBomb&&this.clusterBomb.render(e),this.renderHUD(e)}renderHUD(e){e.fillStyle="white",e.font="20px Arial",e.textAlign="left",e.fillText(`Score: ${this.player.score}`,10,30),e.fillText(`Lives: ${this.player.lives}`,10,60),e.fillText(`Bombs: ${this.player.bombs}`,10,90);const t=Math.max(0,this.LEVEL_DURATION-this.gameTimer),i=Math.floor(t/60),h=Math.floor(t%60);e.textAlign="right",e.fillText(`Time: ${i}:${h.toString().padStart(2,"0")}`,a.SCREEN_WIDTH-10,30)}}class d{constructor(e,t=0){s(this,"game");s(this,"timer",0);s(this,"duration",2);s(this,"shipType");this.game=e,this.shipType=t}enter(){console.log("Entering StageIntro State")}exit(){console.log("Exiting StageIntro State")}update(e){this.timer+=e,this.timer>=this.duration&&this.game.getStateMachine().changeState(new A(this.game,this.shipType))}render(e){const t=e.canvas.width,i=e.canvas.height;e.fillStyle="black",e.fillRect(0,0,t,i),e.fillStyle="white",e.font="48px Arial",e.textAlign="center",e.fillText("STAGE 1",t/2,i/2),e.font="24px Arial",e.fillText("GET READY!",t/2,i/2+50)}}class _{constructor(e){s(this,"game");s(this,"selectedShip",0);this.game=e}enter(){console.log("Entering PlayerSelect State")}exit(){console.log("Exiting PlayerSelect State")}update(e){const t=this.game.getInputManager();t.isPressed("ArrowLeft")&&(this.selectedShip=(this.selectedShip-1+3)%3),t.isPressed("ArrowRight")&&(this.selectedShip=(this.selectedShip+1)%3),(t.isPressed("Enter")||t.isPressed("Space"))&&(console.log(`Ship ${this.selectedShip} selected`),this.game.getStateMachine().changeState(new d(this.game,this.selectedShip)))}render(e){const t=e.canvas.width,i=e.canvas.height;e.fillStyle="black",e.fillRect(0,0,t,i),e.fillStyle="white",e.font="36px Arial",e.textAlign="center",e.fillText("SELECT YOUR SHIP",t/2,i/4);for(let h=0;h<3;h++){const n=t/4*(h+1),r=i/2;h===this.selectedShip&&(e.strokeStyle="yellow",e.lineWidth=3,e.strokeRect(n-40,r-40,80,80));const p=["cyan","lime","magenta"];e.fillStyle=p[h],e.beginPath(),h===0?(e.moveTo(n,r-16),e.lineTo(n+16,r+16),e.lineTo(n-16,r+16)):h===1?(e.moveTo(n,r-20),e.lineTo(n+10,r+16),e.lineTo(n-10,r+16)):(e.moveTo(n,r-12),e.lineTo(n+20,r+16),e.lineTo(n-20,r+16)),e.closePath(),e.fill()}e.fillStyle="white",e.font="24px Arial",e.fillText("Press SPACE to Confirm",t/2,i*.8)}}class f{constructor(e){s(this,"game");this.game=e}enter(){console.log("Entering Attract State")}exit(){console.log("Exiting Attract State")}update(e){const t=this.game.getInputManager();(t.isPressed("Space")||t.isPressed("Enter"))&&this.game.getStateMachine().changeState(new _(this.game))}render(e){const t=e.canvas.width,i=e.canvas.height;e.fillStyle="black",e.fillRect(0,0,t,i),e.fillStyle="white",e.font="48px Arial",e.textAlign="center",e.fillText("VERTICAL SHOOTER",t/2,i/3),e.font="24px Arial",e.fillText("Press SPACE to Start",t/2,i/2)}}class I{constructor(e){s(this,"canvas");s(this,"ctx");s(this,"stateMachine");s(this,"inputManager");s(this,"lastTime",0);this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.stateMachine=new E,this.inputManager=new S,this.stateMachine.changeState(new f(this))}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this))}loop(e){const t=(e-this.lastTime)/1e3;this.lastTime=e,this.update(t),this.render(),requestAnimationFrame(this.loop.bind(this))}update(e){this.stateMachine.update(e),this.inputManager.update()}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.stateMachine.render(this.ctx)}getStateMachine(){return this.stateMachine}getInputManager(){return this.inputManager}getCanvas(){return this.canvas}}document.querySelector("#app").innerHTML=`
  <div>
    <canvas id="gameCanvas" width="600" height="800"></canvas>
  </div>
`;const H=new I("gameCanvas");H.start();
